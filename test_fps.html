<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Test FPS - requestAnimationFrame</title>
  <style>
    body { background: #222; color: #fff; font-family: monospace; }
    #fps { font-size: 2em; margin: 20px; }
    #chart { display: flex; align-items: flex-end; height: 100px; margin: 20px; }
    .bar { width: 2px; background: #0f0; margin-right: 1px; }
  </style>
</head>
<body>
  <div id="fps">FPS: ...</div>
  <div id="dt">Δt: ... ms</div>
  <div id="chart"></div>
  <script>
    let last = performance.now();
    let frames = [];
    let chart = document.getElementById('chart');
    function loop(now) {
      let dt = now - last;
      last = now;
      frames.push(dt);
      if (frames.length > 60) frames.shift();
      // FPS
      let avg = frames.reduce((a, b) => a + b, 0) / frames.length;
      let fps = (1000 / avg).toFixed(1);
      document.getElementById('fps').textContent = 'FPS: ' + fps;
      document.getElementById('dt').textContent = 'Δt: ' + avg.toFixed(2) + ' ms';
      // Chart
      chart.innerHTML = '';
      for (let v of frames) {
        let bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = (v < 34 ? 100 - v * 2 : 2) + 'px';
        bar.style.background = v < 20 ? '#0f0' : v < 30 ? '#ff0' : '#f00';
        chart.appendChild(bar);
      }
      requestAnimationFrame(loop);
    }
    requestAnimationFrame(loop);
  </script>
</body>
</html>